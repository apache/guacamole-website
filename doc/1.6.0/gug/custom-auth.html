
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Custom authentication &#8212; Apache Guacamole Manual v1.6.0</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="_static/gug.css?v=475feb7f" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=c136e461"></script>
    <script src="_static/tabs.js?v=3ee01567"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'custom-auth';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Event listeners" href="event-listeners.html" />
    <link rel="prev" title="Adding new protocols" href="custom-protocols.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
  
    <p class="title logo__title">Apache Guacamole Manual v1.6.0</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="guacamole-architecture.html">Implementation and architecture</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="installing-guacamole.html">Installing Guacamole</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="guacamole-native.html">Native installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="guacamole-docker.html">Containerized (Docker) installation</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="jdbc-auth.html">Database setup</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="mysql-auth.html">MariaDB / MySQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="postgresql-auth.html">PostgreSQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="sqlserver-auth.html">SQL Server</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="security.html">Securing a Guacamole install</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="reverse-proxy.html">SSL termination</a></li>
<li class="toctree-l2"><a class="reference internal" href="auth-ban.html">Blocking brute-force attacks</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Using Guacamole</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="configuring-guacamole.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="using-guacamole.html">General usage</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="administration.html">Administration</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="batch-import.html">Importing connections</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Extensions</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ldap-auth.html">Active Directory / LDAP</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="mfa.html">Multi-factor authentication</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="duo-auth.html">Duo</a></li>
<li class="toctree-l2"><a class="reference internal" href="totp-auth.html">TOTP</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="sso.html">Single sign-on</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="cas-auth.html">CAS</a></li>
<li class="toctree-l2"><a class="reference internal" href="openid-auth.html">OpenID Connect</a></li>
<li class="toctree-l2"><a class="reference internal" href="saml-auth.html">SAML</a></li>
<li class="toctree-l2"><a class="reference internal" href="ssl-auth.html">Smart cards / Certificates</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="vault.html">Retrieving secrets from a vault</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="external-auth.html">External authentication</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="json-auth.html">Encrypted, signed JSON</a></li>
<li class="toctree-l2"><a class="reference internal" href="header-auth.html">HTTP header</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="radius-auth.html">RADIUS</a></li>
<li class="toctree-l1"><a class="reference internal" href="adhoc-connections.html">Ad-hoc connections</a></li>
<li class="toctree-l1"><a class="reference internal" href="auth-restrict.html">Login / Connection restrictions</a></li>
<li class="toctree-l1"><a class="reference internal" href="recording-playback.html">Session recording player</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Developer's Guide</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="guacamole-protocol.html">The Guacamole protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="libguac.html">libguac</a></li>
<li class="toctree-l1"><a class="reference internal" href="guacamole-common.html">guacamole-common</a></li>
<li class="toctree-l1"><a class="reference internal" href="guacamole-common-js.html">guacamole-common-js</a></li>
<li class="toctree-l1"><a class="reference internal" href="guacamole-ext.html">guacamole-ext</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom-protocols.html">Adding new protocols</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Custom authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="event-listeners.html">Event listeners</a></li>
<li class="toctree-l1"><a class="reference internal" href="writing-you-own-guacamole-app.html">Writing your own Guacamole application</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="protocol-reference.html">Guacamole protocol reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="jdbc-auth-schema.html">Database schema reference</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">



<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Custom authentication</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#guacamoles-authentication-model">Guacamole’s authentication model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-guacamole-extension-skeleton">A Guacamole extension skeleton</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#building-the-extension">Building the extension</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-and-authentication">Configuration and authentication</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parsing-the-configuration">Parsing the configuration</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installing-the-extension">Installing the extension</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="custom-authentication">
<h1>Custom authentication<a class="headerlink" href="#custom-authentication" title="Link to this heading">#</a></h1>
<p>Guacamole’s authentication layer is designed to be extendable such that users
can integrate Guacamole into existing authentication systems without having to
resort to writing their own web application around the Guacamole API.</p>
<p>The web application comes with a default authentication mechanism which uses an
XML file to associate users with connections. Extensions for Guacamole that
provide LDAP-based authentication or database-based authentication have also
been developed.</p>
<p>To demonstrate the principles involved, we will implement a very simple
authentication extension which associates a single user/password pair with a
single connection, with all this information saved in properties inside the
<code class="docutils literal notranslate"><span class="pre">guacamole.properties</span></code> file.</p>
<p>In general, all other authentication extensions for Guacamole will use the
principles demonstrated here. This tutorial demonstrates the simplest way to
create an authentication extension for Guacamole - an authentication extension
that does not support management of users and connections via the web
interface.</p>
<section id="guacamoles-authentication-model">
<span id="custom-auth-model"></span><h2>Guacamole’s authentication model<a class="headerlink" href="#guacamoles-authentication-model" title="Link to this heading">#</a></h2>
<p>When you view any page in Guacamole, whether that be the login screen or the
client interface, the page makes an authentication attempt with the web
application, sending all available credentials. After entering your username
and password, the exact same process occurs, except the web application
receives the username and password as well.</p>
<p>The web application handles this authentication attempt by collecting all
credentials available and passing them to designated classes called
“authentication providers”. Given the set of credentials, authentication
providers return a context object that provides restricted access to other
users and connections, if any.</p>
</section>
<section id="a-guacamole-extension-skeleton">
<span id="custom-auth-skeleton"></span><h2>A Guacamole extension skeleton<a class="headerlink" href="#a-guacamole-extension-skeleton" title="Link to this heading">#</a></h2>
<p>For simplicity’s sake, and because this is how things are done upstream in the
Guacamole project, we will use Maven to build our extension.</p>
<p>The bare minimum required for a Guacamole authentication extension is a
<code class="docutils literal notranslate"><span class="pre">pom.xml</span></code> file listing guacamole-ext as a dependency, a single .java file
implementing our stub of an authentication provider, and a <code class="docutils literal notranslate"><span class="pre">guac-manifest.json</span></code>
file describing the extension and pointing to our authentication provider
class.</p>
<p>In our stub, we won’t actually do any authentication yet; we’ll just
universally reject all authentication attempts by returning <code class="docutils literal notranslate"><span class="pre">null</span></code> for any
credentials given. You can verify that this is what happens by checking the
server logs.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;project</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span>
<span class="w">    </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="w">    </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0</span>
<span class="s">                        http://maven.apache.org/maven-v4_0_0.xsd&quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
<span class="w">    </span><span class="nt">&lt;groupId&gt;</span>org.apache.guacamole<span class="nt">&lt;/groupId&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>guacamole-auth-tutorial<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">    </span><span class="nt">&lt;packaging&gt;</span>jar<span class="nt">&lt;/packaging&gt;</span>
<span class="w">    </span><span class="nt">&lt;version&gt;</span>1.6.0<span class="nt">&lt;/version&gt;</span>
<span class="w">    </span><span class="nt">&lt;name&gt;</span>guacamole-auth-tutorial<span class="nt">&lt;/name&gt;</span>

<span class="w">    </span><span class="nt">&lt;properties&gt;</span>
<span class="w">        </span><span class="nt">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.build.sourceEncoding&gt;</span>
<span class="w">    </span><span class="nt">&lt;/properties&gt;</span>

<span class="w">    </span><span class="nt">&lt;build&gt;</span>
<span class="w">        </span><span class="nt">&lt;plugins&gt;</span>

<span class="w">            </span><span class="cm">&lt;!-- Written for Java 8 --&gt;</span>
<span class="w">            </span><span class="nt">&lt;plugin&gt;</span>
<span class="w">                </span><span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
<span class="w">                </span><span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">                </span><span class="nt">&lt;version&gt;</span>3.3<span class="nt">&lt;/version&gt;</span>
<span class="w">                </span><span class="nt">&lt;configuration&gt;</span>
<span class="w">                    </span><span class="nt">&lt;source&gt;</span>1.8<span class="nt">&lt;/source&gt;</span>
<span class="w">                    </span><span class="nt">&lt;target&gt;</span>1.8<span class="nt">&lt;/target&gt;</span>
<span class="w">                </span><span class="nt">&lt;/configuration&gt;</span>
<span class="w">            </span><span class="nt">&lt;/plugin&gt;</span>

<span class="w">        </span><span class="nt">&lt;/plugins&gt;</span>
<span class="w">    </span><span class="nt">&lt;/build&gt;</span>

<span class="w">    </span><span class="nt">&lt;dependencies&gt;</span>

<span class="w">        </span><span class="cm">&lt;!-- Guacamole Extension API --&gt;</span>
<span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">            </span><span class="nt">&lt;groupId&gt;</span>org.apache.guacamole<span class="nt">&lt;/groupId&gt;</span>
<span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>guacamole-ext<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">            </span><span class="nt">&lt;version&gt;</span>1.6.0<span class="nt">&lt;/version&gt;</span>
<span class="w">            </span><span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
<span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>

<span class="w">    </span><span class="nt">&lt;/dependencies&gt;</span>

<span class="nt">&lt;/project&gt;</span>
</pre></div>
</div>
<p>We won’t need to update this <code class="docutils literal notranslate"><span class="pre">pom.xml</span></code> throughout the rest of the tutorial.
Even after adding new files, Maven will just find them and compile as
necessary.</p>
<p>Naturally, we need the actual authentication extension skeleton code.  While
you can put this in whatever file and package you want, for the sake of this
tutorial, we will assume you are using
<code class="docutils literal notranslate"><span class="pre">org.apache.guacamole.auth.TutorialAuthenticationProvider</span></code>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">org.apache.guacamole.auth</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Map</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.guacamole.GuacamoleException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.guacamole.net.auth.simple.SimpleAuthenticationProvider</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.guacamole.net.auth.Credentials</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.guacamole.protocol.GuacamoleConfiguration</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Authentication provider implementation intended to demonstrate basic use</span>
<span class="cm"> * of Guacamole&#39;s extension API. The credentials and connection information for</span>
<span class="cm"> * a single user are stored directly in guacamole.properties.</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TutorialAuthenticationProvider</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">SimpleAuthenticationProvider</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getIdentifier</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;tutorial&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">GuacamoleConfiguration</span><span class="o">&gt;</span>
<span class="w">        </span><span class="nf">getAuthorizedConfigurations</span><span class="p">(</span><span class="n">Credentials</span><span class="w"> </span><span class="n">credentials</span><span class="p">)</span>
<span class="w">        </span><span class="kd">throws</span><span class="w"> </span><span class="n">GuacamoleException</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="c1">// Do nothing ... yet</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">        </span>

<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>To conform with Maven, this skeleton file must be placed within
<code class="docutils literal notranslate"><span class="pre">src/main/java/org/apache/guacamole/auth</span></code> as
<code class="docutils literal notranslate"><span class="pre">TutorialAuthenticationProvider.java</span></code>.</p>
<p>Notice how simple the authentication provider is. The
<code class="docutils literal notranslate"><span class="pre">SimpleAuthenticationProvider</span></code> base class simplifies the
<code class="docutils literal notranslate"><span class="pre">AuthenticationProvider</span></code> interface, requiring nothing more than a unique
identifier (we will use “tutorial”) and a single getAuthorizedConfigurations()
implementation, which must return a <code class="docutils literal notranslate"><span class="pre">Map</span></code> of <code class="docutils literal notranslate"><span class="pre">GuacamoleConfiguration</span></code> each
associated with some arbitrary unique ID. This unique ID will be presented to
the user in the connection list after they log in.</p>
<p>For now, <code class="docutils literal notranslate"><span class="pre">getAuthorizedConfigurations()</span></code> will just return <code class="docutils literal notranslate"><span class="pre">null</span></code>. This will
cause Guacamole to report an invalid login for every attempt. Note that there
is a difference in semantics between returning an empty map and returning
<code class="docutils literal notranslate"><span class="pre">null</span></code>, as the former indicates the credentials are authorized but simply have
no associated configurations, while the latter indicates the credentials are
not authorized at all.</p>
<p>The only remaining piece for the overall skeleton to be complete is a
<code class="docutils literal notranslate"><span class="pre">guac-manifest.json</span></code> file. <em>This file is absolutely required for all Guacamole
extensions.</em> The <code class="docutils literal notranslate"><span class="pre">guac-manifest.json</span></code> format is described in more detail in
<a class="reference internal" href="guacamole-ext.html"><span class="doc std std-doc">guacamole-ext</span></a>. It provides for quite a few properties, but for our
authentication extension we are mainly interested in the Guacamole version
sanity check (to make sure an extension built for the API of Guacamole version
X is not accidentally used against version Y) and telling Guacamole where to
find our authentication provider class.</p>
<p>The Guacamole extension format requires that <code class="docutils literal notranslate"><span class="pre">guac-manifest.json</span></code> be placed in
the root directory of the extension <code class="docutils literal notranslate"><span class="pre">.jar</span></code> file. To accomplish this with Maven,
we place it within the <code class="docutils literal notranslate"><span class="pre">src/main/resources</span></code> directory. Maven will automatically
pick it up during the build and include it within the <code class="docutils literal notranslate"><span class="pre">.jar</span></code>.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>

<span class="w">    </span><span class="nt">&quot;guacamoleVersion&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.6.0&quot;</span><span class="p">,</span>

<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="w">      </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Tutorial Authentication Extension&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;namespace&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;guac-auth-tutorial&quot;</span><span class="p">,</span>

<span class="w">    </span><span class="nt">&quot;authProviders&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;org.apache.guacamole.auth.TutorialAuthenticationProvider&quot;</span>
<span class="w">    </span><span class="p">]</span>

<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="building-the-extension">
<span id="custom-auth-building"></span><h2>Building the extension<a class="headerlink" href="#building-the-extension" title="Link to this heading">#</a></h2>
<p>Once all three of the above files are in place, the extension will build, and
can even be installed within Guacamole (see <a class="reference internal" href="#custom-auth-installing"><span class="std std-ref">Installing the extension</span></a> at the
end of this chapter), even though it is just a skeleton at this point. It won’t
do anything yet other than reject all authentication attempts, but it’s good to
at least try building the extension to make sure nothing is missing and that
all steps have been followed correctly so far:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>mvn<span class="w"> </span>package
<span class="go">[INFO] Scanning for projects...</span>
<span class="go">[INFO] ------------------------------------------------------------------------</span>
<span class="go">[INFO] Building guacamole-auth-tutorial 1.6.0</span>
<span class="go">[INFO] ------------------------------------------------------------------------</span>
<span class="go">...</span>
<span class="go">[INFO] ------------------------------------------------------------------------</span>
<span class="go">[INFO] BUILD SUCCESS</span>
<span class="go">[INFO] ------------------------------------------------------------------------</span>
<span class="go">[INFO] Total time: 2.345 s</span>
<span class="go">[INFO] Finished at: 2015-12-16T13:39:00-08:00</span>
<span class="go">[INFO] Final Memory: 14M/138M</span>
<span class="go">[INFO] ------------------------------------------------------------------------</span>
<span class="gp">$</span>
</pre></div>
</div>
<p>Assuming you see the “<code class="docutils literal notranslate"><span class="pre">BUILD</span> <span class="pre">SUCCESS</span></code>” message when you build the extension,
there will be a new file, <code class="docutils literal notranslate"><span class="pre">target/guacamole-auth-tutorial-1.6.0.jar</span></code>, which can
be installed within Guacamole and tested. If you changed the name or version of
the project in the <code class="docutils literal notranslate"><span class="pre">pom.xml</span></code> file, the name of this new <code class="docutils literal notranslate"><span class="pre">.jar</span></code> file will be
different, but it can still be found within <code class="docutils literal notranslate"><span class="pre">target/</span></code>.</p>
</section>
<section id="configuration-and-authentication">
<span id="custom-auth-config"></span><h2>Configuration and authentication<a class="headerlink" href="#configuration-and-authentication" title="Link to this heading">#</a></h2>
<p>Once we receive credentials, we need to validate those credentials against the
associated properties in <code class="docutils literal notranslate"><span class="pre">guacamole.properties</span></code> (our source of authentication
information for the sake of this tutorial).</p>
<p>We will define four properties:</p>
<dl class="simple myst">
<dt><code class="docutils literal notranslate"><span class="pre">tutorial-user</span></code></dt><dd><p>The name of the only user we accept.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">tutorial-password</span></code></dt><dd><p>The password we require for the user specified to be authenticated.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">tutorial-protocol</span></code></dt><dd><p>The protocol of the configuration this user is authorized to use, which
will be sent to guacd when the user logs in and selects their connection.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">tutorial-parameters</span></code></dt><dd><p>A comma-delimited list of <code class="docutils literal notranslate"><span class="pre">name=value</span></code> pairs. For the sake of simplicity,
we’ll assume there will never be any commas in the values.</p>
</dd>
</dl>
<p>If the username and password match what is stored in the file, we read the
configuration information, store it in a <code class="docutils literal notranslate"><span class="pre">GuacamoleConfiguration</span></code>, and return
the configuration within a set, telling Guacamole that this user is authorized
but only to access the configurations returned.</p>
<p>Upstream, we always place the properties of authentication providers in their
own class, and so we will also do that here in this tutorial, as it keeps
things organized.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">org.apache.guacamole.auth</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.apache.guacamole.properties.StringGuacamoleProperty</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Utility class containing all properties used by the custom authentication</span>
<span class="cm"> * tutorial. The properties defined here must be specified within</span>
<span class="cm"> * guacamole.properties to configure the tutorial authentication provider.</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TutorialGuacamoleProperties</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * This class should not be instantiated.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="nf">TutorialGuacamoleProperties</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * The only user to allow.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">StringGuacamoleProperty</span><span class="w"> </span><span class="n">TUTORIAL_USER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">StringGuacamoleProperty</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nd">@Override</span>
<span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;tutorial-user&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * The password required for the specified user.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">StringGuacamoleProperty</span><span class="w"> </span><span class="n">TUTORIAL_PASSWORD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">StringGuacamoleProperty</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nd">@Override</span>
<span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;tutorial-password&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="p">};</span>


<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * The protocol to use when connecting.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">StringGuacamoleProperty</span><span class="w"> </span><span class="n">TUTORIAL_PROTOCOL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">StringGuacamoleProperty</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nd">@Override</span>
<span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;tutorial-protocol&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="p">};</span>


<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * All parameters associated with the connection, as a comma-delimited</span>
<span class="cm">     * list of name=&quot;value&quot; </span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">StringGuacamoleProperty</span><span class="w"> </span><span class="n">TUTORIAL_PARAMETERS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">StringGuacamoleProperty</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nd">@Override</span>
<span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getName</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;tutorial-parameters&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="p">};</span>

<span class="p">}</span>
</pre></div>
</div>
<p>Normally, we would define a new type of <code class="docutils literal notranslate"><span class="pre">GuacamoleProperty</span></code> to handle the
parsing of the parameters required by <code class="docutils literal notranslate"><span class="pre">TUTORIAL_PARAMETERS</span></code>, but for the sake
of simplicity, parsing of this parameter will be embedded in the authentication
function later.</p>
<p>You will need to modify your existing <code class="docutils literal notranslate"><span class="pre">guacamole.properties</span></code> file, adding each
of the above properties to describe one of your available connections.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># Username and password
tutorial-user:     tutorial
tutorial-password: password

# Connection information
tutorial-protocol:   vnc
tutorial-parameters: hostname=localhost, port=5900
</pre></div>
</div>
<p>Once these properties and their accessor class are in place, it’s simple enough
to read the properties within <code class="docutils literal notranslate"><span class="pre">getAuthorizedConfigurations()</span></code> and authenticate
the user based on their username and password.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">public</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">GuacamoleConfiguration</span><span class="o">&gt;</span>
<span class="w">    </span><span class="nf">getAuthorizedConfigurations</span><span class="p">(</span><span class="n">Credentials</span><span class="w"> </span><span class="n">credentials</span><span class="p">)</span>
<span class="w">    </span><span class="kd">throws</span><span class="w"> </span><span class="n">GuacamoleException</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// Get the Guacamole server environment</span>
<span class="w">    </span><span class="n">Environment</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LocalEnvironment</span><span class="p">.</span><span class="na">getInstance</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Get username from guacamole.properties</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">environment</span><span class="p">.</span><span class="na">getRequiredProperty</span><span class="p">(</span>
<span class="w">        </span><span class="n">TutorialGuacamoleProperties</span><span class="p">.</span><span class="na">TUTORIAL_USER</span>
<span class="w">    </span><span class="p">);</span><span class="w">      </span>

<span class="w">    </span><span class="c1">// If wrong username, fail</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">username</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">credentials</span><span class="p">.</span><span class="na">getUsername</span><span class="p">()))</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Get password from guacamole.properties</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">environment</span><span class="p">.</span><span class="na">getRequiredProperty</span><span class="p">(</span>
<span class="w">        </span><span class="n">TutorialGuacamoleProperties</span><span class="p">.</span><span class="na">TUTORIAL_PASSWORD</span>
<span class="w">    </span><span class="p">);</span><span class="w">      </span>

<span class="w">    </span><span class="c1">// If wrong password, fail</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">password</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">credentials</span><span class="p">.</span><span class="na">getPassword</span><span class="p">()))</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Successful login. Return configurations (STUB)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">GuacamoleConfiguration</span><span class="o">&gt;</span><span class="p">();</span>

<span class="p">}</span>
</pre></div>
</div>
<p>As is, the authentication provider will work in its current state in that the
correct username and password will authenticate the user, while an incorrect
username or password will not, but we still aren’t returning an actual map of
configurations. We need to construct the configuration based on the properties
in the <code class="docutils literal notranslate"><span class="pre">guacamole.properties</span></code> file after the user has been authenticated, and
return that configuration to the web application.</p>
</section>
<section id="parsing-the-configuration">
<span id="custom-auth-more-config"></span><h2>Parsing the configuration<a class="headerlink" href="#parsing-the-configuration" title="Link to this heading">#</a></h2>
<p>The only remaining task before we have a fully-functioning authentication
provider is to actually parse the configuration from the <code class="docutils literal notranslate"><span class="pre">guacamole.properties</span></code>
file.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">public</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">GuacamoleConfiguration</span><span class="o">&gt;</span>
<span class="w">    </span><span class="nf">getAuthorizedConfigurations</span><span class="p">(</span><span class="n">Credentials</span><span class="w"> </span><span class="n">credentials</span><span class="p">)</span>
<span class="w">    </span><span class="kd">throws</span><span class="w"> </span><span class="n">GuacamoleException</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// Get the Guacamole server environment</span>
<span class="w">    </span><span class="n">Environment</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LocalEnvironment</span><span class="p">.</span><span class="na">getInstance</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Get username from guacamole.properties</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">environment</span><span class="p">.</span><span class="na">getRequiredProperty</span><span class="p">(</span>
<span class="w">        </span><span class="n">TutorialGuacamoleProperties</span><span class="p">.</span><span class="na">TUTORIAL_USER</span>
<span class="w">    </span><span class="p">);</span><span class="w">      </span>

<span class="w">    </span><span class="c1">// If wrong username, fail</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">username</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">credentials</span><span class="p">.</span><span class="na">getUsername</span><span class="p">()))</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Get password from guacamole.properties</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">environment</span><span class="p">.</span><span class="na">getRequiredProperty</span><span class="p">(</span>
<span class="w">        </span><span class="n">TutorialGuacamoleProperties</span><span class="p">.</span><span class="na">TUTORIAL_PASSWORD</span>
<span class="w">    </span><span class="p">);</span><span class="w">      </span>

<span class="w">    </span><span class="c1">// If wrong password, fail</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">password</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">credentials</span><span class="p">.</span><span class="na">getPassword</span><span class="p">()))</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Successful login. Return configurations.</span>
<span class="w">    </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">GuacamoleConfiguration</span><span class="o">&gt;</span><span class="w"> </span><span class="n">configs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">GuacamoleConfiguration</span><span class="o">&gt;</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Create new configuration</span>
<span class="w">    </span><span class="n">GuacamoleConfiguration</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GuacamoleConfiguration</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Set protocol specified in properties</span>
<span class="w">    </span><span class="n">config</span><span class="p">.</span><span class="na">setProtocol</span><span class="p">(</span><span class="n">environment</span><span class="p">.</span><span class="na">getRequiredProperty</span><span class="p">(</span>
<span class="w">        </span><span class="n">TutorialGuacamoleProperties</span><span class="p">.</span><span class="na">TUTORIAL_PROTOCOL</span>
<span class="w">    </span><span class="p">));</span>

<span class="w">    </span><span class="c1">// Set all parameters, splitting at commas</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">parameterValue</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">environment</span><span class="p">.</span><span class="na">getRequiredProperty</span><span class="p">(</span>
<span class="w">        </span><span class="n">TutorialGuacamoleProperties</span><span class="p">.</span><span class="na">TUTORIAL_PARAMETERS</span>
<span class="w">    </span><span class="p">).</span><span class="na">split</span><span class="p">(</span><span class="s">&quot;,\\s*&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="c1">// Find the equals sign</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">equals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parameterValue</span><span class="p">.</span><span class="na">indexOf</span><span class="p">(</span><span class="sc">&#39;=&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">equals</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GuacamoleServerException</span><span class="p">(</span><span class="s">&quot;Required equals sign missing&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Get name and value from parameter string</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parameterValue</span><span class="p">.</span><span class="na">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">equals</span><span class="p">);</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parameterValue</span><span class="p">.</span><span class="na">substring</span><span class="p">(</span><span class="n">equals</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Set parameter as specified</span>
<span class="w">        </span><span class="n">config</span><span class="p">.</span><span class="na">setParameter</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span>

<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">configs</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;Tutorial Connection&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">configs</span><span class="p">;</span>

<span class="p">}</span>
</pre></div>
</div>
<p>The extension is now complete and can be built as described earlier in
<a class="reference internal" href="#custom-auth-building"><span class="std std-ref">Building the extension</span></a>.</p>
</section>
<section id="installing-the-extension">
<span id="custom-auth-installing"></span><h2>Installing the extension<a class="headerlink" href="#installing-the-extension" title="Link to this heading">#</a></h2>
<p>Guacamole extensions are self-contained <code class="docutils literal notranslate"><span class="pre">.jar</span></code> files which are installed by
being placed within <code class="docutils literal notranslate"><span class="pre">GUACAMOLE_HOME/extensions</span></code>, and this extension is no
different. As described in <a class="reference internal" href="configuring-guacamole.html"><span class="doc std std-doc">Configuring Guacamole</span></a>, <code class="docutils literal notranslate"><span class="pre">GUACAMOLE_HOME</span></code> is a
placeholder used to refer to the directory that Guacamole uses to locate its
configuration files and extensions. Typically, this will be the <code class="docutils literal notranslate"><span class="pre">.guacamole</span></code>
directory within the home directory of the user running Tomcat.</p>
<p>To install your extension, ensure that the required properties have been added
to your <code class="docutils literal notranslate"><span class="pre">guacamole.properties</span></code>, copy the
<code class="docutils literal notranslate"><span class="pre">target/guacamole-auth-tutorial-1.6.0.jar</span></code> file into
<code class="docutils literal notranslate"><span class="pre">GUACAMOLE_HOME/extensions</span></code> and restart Tomcat. Guacamole will automatically
load your extension, logging an informative message that it has done so:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Extension &quot;Tutorial Authentication Extension&quot; loaded.
</pre></div>
</div>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="custom-protocols.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Adding new protocols</p>
      </div>
    </a>
    <a class="right-next"
       href="event-listeners.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Event listeners</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#guacamoles-authentication-model">Guacamole’s authentication model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-guacamole-extension-skeleton">A Guacamole extension skeleton</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#building-the-extension">Building the extension</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-and-authentication">Configuration and authentication</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parsing-the-configuration">Parsing the configuration</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installing-the-extension">Installing the extension</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Apache Software Foundation
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025 The Apache Software Foundation.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>